# an+1 = an + an^2/n^2
solve upper bound of a1, s.t. an -> 1

## Method 1. 数学归纳法，同时给 an 找一个尽量紧的上界函数 f(n)

an+1 = an + an^2/n^2 < f(n) + f(n)^2/n^2 需要< f(n+1)

### 先考虑 f(n) 形如 n-k / n+m

(n-k) / (n+m) + (n-k)^2 / (n+m)^2 / n^2
<
(n-k+1) / (n+m+1)

通分

-(k^2 (m + n + 1) - k n (m (n + 2) + n^2 + 2 n + 2) + n^2 (-m^2 + m (1 - n) + n + 1))
/
(n^2 (m + n)^2 (m + n + 1))
> 0

分子展开
+ (k+m-1) n^3
+ (k m + 2k + m^2 -m -1) n^2
+ (-k^2 +2 k m + 2 k) n 
- (k^2 m  + k^2)
> 0

#### 可以令 k = 1, m = 0: 

n^3的系数为0，n^2的系数为1，n的系数为1，常数为-1，因此恒成立
但此时 a1 < 0，初始条件不成立
如果 a2 < 1/2，反推出来所需的 a1 也很小 = 0.366，太弱了
a3 < 2/3，反推出来所需的 a1 可以是0.4，此时a3 = 399/625 = 0.6384，还可以
...

#### 还可以令 k = m = 1/2

此时n^3的系数为0，n^2的系数为0，n的系数为5/4，常数为-3/8，因此恒成立
但此时 a1 < 1/3，太弱了
从第二项开始，则为a1 < 0.4219544403254986
从第三项开始，则为a1 < 0.43199500814080233
...


#### 还可以设为类似 n/(n+k+ε) 

解出来 

< n/(n+k+ε) + 1/(n+k+ε)^2
= (n*(n+k+ε) + 1) / (n+k+ε)^2
需要 < (n+1)/(n+k+1+ε)

等价于

(n*(n+k+ε) + 1)(n+k+1+ε)
<
(n+1)(n+k+ε)^2

算出来要求k=1

an + an^2/n^2
< n/(n+1+ε) + 1/(n+1+ε)^2
= (n*(n+1+ε) + 1) /  (n+1+ε)^2
需要<
(n+1)/(n+2+ε)

等价于

(n*(n+1+ε) + 1)(n+2+ε)
<
(n+1)(n+1+ε)^2

等价于

(n+1)(n+1+ε)^2 - (n*(n+1+ε) + 1)(n+2+ε)
= ε^2 + ε + ε n - 1
> 0

<-

ε >= 1/n
或者说
n >= 1/ε
从这开始就可以往后一直递推
那么前面有限项也满足这一限制即可
又因为是单增，所以只需要
a(1/ε-1) < n/(n+1+ε)
等价于
an < n/(n+1+1/n) = n^2 / n^2+n+1
对某一项n成立即可，当然n越大越好
这个放缩是最不浪费的

给定n
然后从 an = n^2 / n^2+n+1
倒推
an+1 = an + an^2/n^2
反复n次得到结果，解析解太难了
还是二分查找合适的a1=a吧
求出下界为，当ε=0.000001时，第1000000项，下界算出来是0.43605507，所以说用这种方法其实可以给出任意精度的数值解（待证）。

也就是a(1)=0.43605507………时，有任意a(n)<1成立！

[doge]当然有人能算解析解记得at 我一下。



### 升一阶，考虑 f(n) = (n2-mn-p) / (n2+qn+r)

((n+1)^2-m(n+1)-p) / ((n+1)^2+q(n+1)+r) - ((n2-mn-p) / (n2+qn+r) + (n2-mn-p)^2 / (n2+qn+r)^2 / n2)

=

-(m (-n^2 - n + r) + n^2 (-q) + n (-2 p - q - 2 r) + p (-q - 1) - r)
/
((n^2 + n q + r) (n^2 + n (q + 2) + q + r + 1))

- 

(n2-mn-p)^2
/
(n2+qn+r)^2 n^2

分子 =

-(m (-n^2 - n + r) + n^2 (-q) + n (-2 p - q - 2 r) + p (-q - 1) - r) (n2+qn+r)^2 n^2
- (n2-mn-p)^2 (n^2 + n q + r) (n^2 + n (q + 2) + q + r + 1)

m n^8 + 2 m n^7 q + m n^7 + m n^6 q^2 + 2 m n^6 q + m n^6 r + m n^5 q^2 + 2 m n^5 r - m n^4 q^2 r + 2 m n^4 q r - m n^4 r^2 - 2 m n^3 q r^2 + m n^3 r^2 - m n^2 r^3 + n^8 q + 2 n^7 p + 2 n^7 q^2 + n^7 q + 2 n^7 r + 5 n^6 p q + n^6 p + n^6 q^3 + 2 n^6 q^2 + 6 n^6 q r + n^6 r + 4 n^5 p q^2 + 2 n^5 p q + 4 n^5 p r + n^5 q^3 + 4 n^5 q^2 r + 4 n^5 q r + 4 n^5 r^2 + n^4 p q^3 + n^4 p q^2 + 6 n^4 p q r + 2 n^4 p r + 3 n^4 q^2 r + 5 n^4 q r^2 + 2 n^4 r^2 + 2 n^3 p q^2 r + 2 n^3 p q r + 2 n^3 p r^2 + 3 n^3 q r^2 + 2 n^3 r^3 + n^2 p q r^2 + n^2 p r^2 + n^2 r^3
-m^2 n^6 - 2 m^2 n^5 q - 2 m^2 n^5 - m^2 n^4 q^2 - 3 m^2 n^4 q - 2 m^2 n^4 r - m^2 n^4 - m^2 n^3 q^2 - 2 m^2 n^3 q r - m^2 n^3 q - 2 m^2 n^3 r - m^2 n^2 q r - m^2 n^2 r^2 - m^2 n^2 r + 2 m n^7 + 4 m n^6 q + 4 m n^6 - 2 m n^5 p + 2 m n^5 q^2 + 6 m n^5 q + 4 m n^5 r + 2 m n^5 - 4 m n^4 p q - 4 m n^4 p + 2 m n^4 q^2 + 4 m n^4 q r + 2 m n^4 q + 4 m n^4 r - 2 m n^3 p q^2 - 6 m n^3 p q - 4 m n^3 p r - 2 m n^3 p + 2 m n^3 q r + 2 m n^3 r^2 + 2 m n^3 r - 2 m n^2 p q^2 - 4 m n^2 p q r - 2 m n^2 p q - 4 m n^2 p r - 2 m n p q r - 2 m n p r^2 - 2 m n p r - n^8 - 2 n^7 q - 2 n^7 + 2 n^6 p - n^6 q^2 - 3 n^6 q - 2 n^6 r - n^6 + 4 n^5 p q + 4 n^5 p - n^5 q^2 - 2 n^5 q r - n^5 q - 2 n^5 r - n^4 p^2 + 2 n^4 p q^2 + 6 n^4 p q + 4 n^4 p r + 2 n^4 p - n^4 q r - n^4 r^2 - n^4 r - 2 n^3 p^2 q - 2 n^3 p^2 + 2 n^3 p q^2 + 4 n^3 p q r + 2 n^3 p q + 4 n^3 p r - n^2 p^2 q^2 - 3 n^2 p^2 q - 2 n^2 p^2 r - n^2 p^2 + 2 n^2 p q r + 2 n^2 p r^2 + 2 n^2 p r - n p^2 q^2 - 2 n p^2 q r - n p^2 q - 2 n p^2 r - p^2 q r - p^2 r^2 - p^2 r

(m+q-1) n^8
=>
猜测 m = q = 1/2
或者 m = 0, q = 1
或者 m = 1, q = 0

(2mq + 3m + 2p + 2q2 + 2r - q - 2) n^7
=>
如果m = q = 1/2
则 p + r = 0
p = r = 0：降次了，跟一次的情况一样，没有意义
老老实实带入 m = 1-q
= 2(1-q)q + 3(1-q) + 2p + 2q2 + 2r - q - 2
= 2 p - 2 q + 2 r + 1
if q = 1, then p = r = 1/4：n2 - 1/4 / n2 + n + 1/4，降次了，跟一次的情况一样，没有意义
if q = 0, then p = r = 0

(m q^2 + 6m q + mr + 5pq + 3p + q3 + q2 + 6qr - r -m2 + 4m -3q -1) n^6
老老实实带入 m = 1-q
= 5 p q + 3 p - 5 q^2 + 5 q r + q + 2
如果m = q = 1/2, p = r = 0
则 = 5/4 > 0
if q = 1, p = r = 1/4
then = 5/4 > 0

if q = 1, 
2 p - 2 q + 2 r + 1 = 0
5 p q + 3 p - 5 q^2 + 5 q r + q + 2
then p = 1/6, r = 1/3



(3mq2 + 6mr + 4pq2 + 6pq + 4pr + q3 + 4q2r + 2qr + 4r2 - 2m2q - 2m2 - 2mp + 6mq + 2m + 4p - q2 - q - 2r) n^5
老老实实带入 m = 1-q
= 3(1-q)q2 + 6(1-q)r + 4pq2 + 6pq + 4pr + q3 + 4q2r + 2qr + 4r2 - 2(1-q)^2 q - 2(1-q)^2 - 2(1-q)p + 6(1-q)q + 2(1-q) + 4p - q2 - q - 2r
= 4 p q^2 + 8 p q + 4 p r + 2 p - 4 q^3 + 4 q^2 r - 2 q^2 - 4 q r + 5 q + 4 r^2 + 4 r
如果这一项等于0，算出来p是负数
p = -11/30, q = 3/5, r = 7/15

#### 结果

wolframalpha 验算

1、
((n+1)^2-0.25) / ((n+1)^2+(n+1)+0.25) - ((n2-0.25) / (n2+n+0.25) + (n2-n-0.25)^2 / (n2+n+0.25)^2 / n2)
> 0 也恒成立
此时 a1 = 
(n2-0.25)
/
(n2+n+0.25)
约分之后就等于 N-0.5 / N+0.5 啊……

2、至于
((n+1)^2-1/6) / ((n+1)^2+(n+1)+1/3) - ((n2-1/6) / (n2+n+1/3) + (n2-n-1/6)^2 / (n2+n+1/3)^2 / n2)
> 0 也恒成立

3、
(n2-2/5 n+ 11/30)
/
(n2+3/5 n+ 7/15)
可以吗？
1 - 2/5 + 11/30
/
1 + 3/5 + 7/15
=
(1 - 2/5 + 11/30) / (1 + 3/5 + 7/15) =  29/62 已经超标了

#### n2 / n2+kn+m+ε

等价于

n2 / n2+kn+m+ε + n2 / (n2+kn+m+ε)2 < (n+1)2 / (n+1)2+k(n+1)+m+ε

等价于

n2(n2+kn+m+1+ε)((n+1)2+kn+k+m+ε) < (n+1)2 (n2+kn+m+ε)2

右边减去左边 在wolfram alpha上算一下
(n + 1)^2 (n^2 + k n + m + ε)^2 - n^2 (n^2 + k n + m + 1 + ε) ((n + 1)^2 + k n + k + m + ε)
=
+ (k -1) n^4 
+ (k^2 + 2m -2) n^3
+ (k^2 +3km -k-1) n^2
+ 2 (m^2 + k m) n 
+ m^2 
+ 2 ε n^3 
+ 3 ε k n^2
+ 2 ε k n + 2 ε^2 n + 4 ε m n 
+ ε^2 + 2 ε m 

k = 1
m = 1/2
使得n^4 n^3两项系数为0
但是此时n^2的系数为正 浪费了啊，就算ε=0也能成立了

f(n) = n2 / n2 +n +1/2
只需要满足 f(1) = 1 / 1 + 1 + 1/2 = 0.4
或者往后多推几项
其实比起上一项更好的，因为N/N+1+eps，本质是N / N+1+1/N = N2 / N2+N+1
现在则是更精确了

### 未来工作

n-1/2 / n+1/2
->
(n-1/2)(n+1/3) / (n+1/2)(n+1/3)
- 1/6 n
+ 1/6 n

而二次项的时候，我们真正得到的是
(n2-1/6) / (n2+n+1/3)

能不能靠配方+一点小修改，搞出更逼近的级数？？？



## Method 2. 取倒数放缩

f(n+1) = f(n) + f(n)^2/n^2 = f(n) + f(n)f(n+1)/n^2   (1/(1+f(n)/n^2)

1/f(n) = 1/f(n+1) + 1/(n^2+f(n))

叠加
1/f(1) - 1/f(n+1) = 1/(1^2+f(1)) + ... + 1/(n^2+f(n))
or 保留一项
1/f(2) - 1/f(n+1) = 1/(2^2+f(2)) + ... + 1/(n^2+f(n))
or 前面可以选择保留n项

### Method 2.1 比较粗、把分母的f(n), f(n+1), ...都扔掉

保留1项
1 / (1 + pi^2/6) = 0.378，比较弱

保留前2项：
1/an+1 > 1/a2 +1 - pi^2/6 需要 >= 1
a2 = a+a^2
所以 1/(a+a^2) +1 - pi^2/6 >= 1
解得 {a<=1/2 (sqrt(24 + π^2)/π - 1)}
= 0.42624...

保留前3项
a3 = a2 + a2^2/2^2 = a+a^2 + (a+a^2)^2/4
1/a3 +1 +1/4 - pi^2/6 >= 1
1/(a+a^2 + (a+a^2)^2/4) +1 +1/4 - pi^2/6 >= 1
解得 0<a<=1/2 (sqrt((21 - 14 π^2 + 8 sqrt(-27 + 12 π^2 + 4 π^4))/(2 π^2 - 3)) - 1)
= 0.43305...

保留前n项
1/an = 1 + 1/4 + ... + 1/(n-1)^2 - pi^2/6 >= 1

### Method 2.2 把分母的f(n), f(n+1), ...都放成f(n)

分母的ai全部保留成某个待定系数a
其实 sum_k 1/(k^2+a) 的精确解可以求
输入 wolfram alpha：1/(1^2+a) + 1/(2^2+a) + ... 获得准确值
再解：￼π coth(sqrt(a) π) a^(3/2) + 3 a + π coth(sqrt(a) π) sqrt(a) + 1)/(2 a (a + 1)
(π coth(sqrt(a) π) a^(3/2) + 3 a + π coth(sqrt(a) π) sqrt(a) + 1)/(2 a (a + 1))
- 1/(a+1) - 1/a = 1/a - 1
得到化简
2 a + π sqrt(a) coth(π sqrt(a)) = 3
近似值为
a1=a≈0.432873

如果再多保留一项，设a2=a，分母的ai(i>=2) 全部保留成a
(π coth(sqrt(a) π) a^(3/2) + 3 a + π coth(sqrt(a) π) sqrt(a) + 1)/(2 a (a + 1))
- 1/(a+1) - 1/a - 1/(a+1)
= 1/a - 1
得到化简
(-3 a + π (a + 1) sqrt(a) coth(π sqrt(a)) - 1)/(2 a (a + 1)) = 1/a - 1
a = 0.625243
再反推a1 = 0.435544

保留n项，设an=a，分母的ai(i>=n) 全部保留成a
(π coth(sqrt(a) π) a^(3/2) + 3 a + π coth(sqrt(a) π) sqrt(a) + 1)/(2 a (a + 1))
- 1/(a+1) - 1/a - 1/(a+1) - ... - 1/(a+(n-1)^2)
= 1/a - 1
同样可以用二分查找来搜索

### 未来工作

还可以再精细一些： f(n) > 另一个函数 g(n) ？
这样就不需要手动保留n项了，也许一项就非常精确



## Method 3. 反向逼近

f(n+1) = f(n) + f(n)^2/n^2

f(n+1)/f(n) = 1 + f(n)/n^2
<
1 + 1/(n^2+n+0.5) 与方法1结合，二次方应该没有更接近的级数了

a[n+1] < a1 array[1] array[2] ... array[n]
a[n+1] < a2 array[2] ... array[n]
...
a[n+1] < ak array[k] ... array[n]

array[0] = 1 + 1/0.5 = 3
array[1] = 1 + 1/2.5 = 1.4
array[2] = 1 + 1/6.5 = ...
...
wolfram alpha gives: product 1 + 1/(n^2+n+0.5) = 6.687/3

同样用二分查找来逼近吧

但是这样反号了。